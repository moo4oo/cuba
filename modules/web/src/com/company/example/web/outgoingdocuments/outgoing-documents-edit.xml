<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/window.xsd"
        caption="msg://editorCaption"
        class="com.company.example.web.outgoingdocuments.OutgoingDocumentsEdit"
        datasource="outgoingDocumentsesDs"
        messagesPack="com.company.example.web.outgoingdocuments">
    <dsContext>
        <datasource id="outgoingDocumentsesDs"
                    class="com.company.example.entity.OutgoingDocuments"
                    view="main-outgoingDocuments-view"/>
        <collectionDatasource id="procAttachmentsDs"
                              class="com.haulmont.bpm.entity.ProcAttachment">
            <query>
                <![CDATA[select e from bpm$ProcAttachment e 
where 
e.procInstance.entity.entityId =
:ds$outgoingDocumentsesDs
order by e.createTs]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="procTasksDs"
                              class="com.haulmont.bpm.entity.ProcTask"
                              view="procTask-view">
            <query>
                <![CDATA[select e from bpm$ProcTask e 
where e.procInstance.entity.entityId
= :ds$outgoingDocumentsesDs.id]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="matchingTablesDs"
                              class="com.company.example.entity.MatchingTable">
            <query>
                <![CDATA[select e from example$MatchingTable e
where e.outgoingDocuments.id
= :ds$outgoingDocumentsesDs.id]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="filesDs"
                              class="com.company.example.entity.File"
                              view="file-view">
            <query>
                <![CDATA[select e from example$File e
where e.outDoc.id = :ds$outgoingDocumentsesDs.id]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <dialogMode height="600"
                width="800"/>
    <layout expand="scrollBox"
            spacing="true">
        <scrollBox id="scrollBox"
                   spacing="true">
            <tabSheet>
                <tab id="mainTab"
                     caption="Main"
                     margin="true"
                     spacing="true">
                    <fieldGroup id="mainFieldGroup"
                                datasource="outgoingDocumentsesDs">
                        <column width="250px">
                            <field property="document_type"/>
                            <field property="registration_number"/>
                            <field property="date"/>
                            <field property="addressee"/>
                            <field property="full_name"/>
                            <field property="topic"/>
                            <field property="executor"/>
                            <field property="sign"/>
                            <field property="description"
                                   rows="5"/>
                            <field property="title"/>
                            <field property="author"/>
                            <field property="create_date"/>
                            <field property="change_date"/>
                            <field property="state"/>
                        </column>
                    </fieldGroup>
                </tab>
                <tab id="documentsTab"
                     caption="Documents"
                     margin="true"
                     spacing="true">
                    <table id="filesTable"
                           height="100%"
                           width="100%">
                        <actions>
                            <action id="create"
                                    openType="DIALOG"/>
                            <action id="edit"
                                    openType="DIALOG"/>
                            <action id="add"
                                    openType="DIALOG"/>
                        </actions>
                        <columns>
                            <column id="file.name"/>
                            <column id="create_time"/>
                            <column id="update_time"/>
                        </columns>
                        <rows datasource="filesDs"/>
                        <buttonsPanel>
                            <button id="createButton"
                                    caption="Create"
                                    invoke="onCreateButtonClick"/>
                            <button id="editButton"
                                    action="filesTable.edit"/>
                        </buttonsPanel>
                    </table>
                </tab>
                <tab id="registrationTab"
                     caption="Registrations"
                     margin="true"
                     spacing="true">
                    <hbox spacing="true">
                        <fieldGroup id="registrationsFieldGroup"
                                    datasource="outgoingDocumentsesDs">
                            <field property="log"/>
                            <field property="registration_number"/>
                            <field property="date"/>
                            <field property="document_description"/>
                            <field property="affair"/>
                            <field property="affair_date"/>
                        </fieldGroup>
                        <button id="registrationBtn"
                                caption="Registration"
                                invoke="onRegistrationBtnClick"
                                visible="false"/>
                    </hbox>
                </tab>
                <tab id="matchingTab"
                     caption="Matching"
                     expand="procTasksTable"
                     margin="true"
                     spacing="true">
                    <table id="procTasksTable"
                           height="400px"
                           width="100%">
                        <columns>
                            <column id="name"/>
                            <column id="procActor.user"/>
                            <column id="startDate"/>
                            <column id="endDate"/>
                            <column id="outcome"/>
                            <column id="comment"/>
                        </columns>
                        <rows datasource="procTasksDs"/>
                    </table>
                    <groupBox id="procActionsBox"
                              caption="process"
                              orientation="vertical"
                              spacing="true"
                              width="AUTO">
                        <frame id="procActionsFrame"
                               screen="procActionsFrame"/>
                    </groupBox>
                </tab>
            </tabSheet>
        </scrollBox>
        <hbox spacing="true"
              width="100%">
            <frame id="windowActions"
                   screen="editWindowActions"/>
            <button id="printCardInfoBtn"
                    align="TOP_RIGHT"
                    caption="Prin Card Report"/>
        </hbox>
    </layout>
</window>
